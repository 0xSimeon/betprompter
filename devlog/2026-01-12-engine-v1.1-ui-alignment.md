# Devlog: ENGINE_SPEC v1.1 + UI/UX Alignment

**Date:** 2026-01-12

---

## Summary

Full alignment with ENGINE_SPEC v1.1 and UI_UX_SPEC v1.1. Engine scoring rewritten, UI hardened for read-only presentation.

---

## Engine Changes (engine.ts)

### Scoring Formula (ENGINE_SPEC v1.1)
```
finalScore = baseMarketScore + polymarketSignal + groqConfidence + geminiPenalty
```

### Base Market Scores
- Match Result: 50
- Double Chance: 45
- Over 1.5: 48
- Over 2.5: 46

### Polymarket Signals
- +10 if volume >= 1000
- +10 if probability aligns with Groq (within 15%)
- -10 if low payout proxy (DC/O1.5 at 96%+)

### Groq Confidence
- HIGH: +20
- MEDIUM: +10
- LOW: 0

### Gemini Penalties
- mild: -15
- strong: -35
- overconfidence + missingContext together: -10 additional

### Category Thresholds
- BANKER: >= 70 AND no strong Gemini caution
- VALUE: 55-69
- RISKY: 40-54
- NO BET: < 40

### Market Usefulness Ceilings
- Over 1.5: blocked as PRIMARY if > 78%
- Double Chance: blocked as PRIMARY if > 75%

### Correlation Constraints
Forbidden PRIMARY/SECONDARY pairs:
- MATCH_RESULT ↔ DOUBLE_CHANCE
- OVER_1_5 ↔ DOUBLE_CHANCE
- OVER_1_5 ↔ OVER_2_5

### Dominance Override
When favorite >= 70%, underdog <= 20%, volume >= 1000:
- ML and Over 2.5: +12 boost
- DC and Over 1.5: -12 penalty

**Blocked when Gemini cautionLevel === "strong"**

---

## UI/UX Changes

### AnalysisCard
- Added "Engine probability: ~X%" to PRIMARY and SECONDARY cards
- Labels: "Banker Pick" / "Value Pick" / "Risky Pick"
- Removed "Refresh to regenerate" anti-pattern text

### MarketSentimentDisplay
- Changed "No market data" → "Market sentiment unavailable"
- Positioned in right column, below header, above Other Markets

### AllMarketsDisplay
- Filters out markets with no usable signal (confidence <= 0)
- Excludes PRIMARY and SECONDARY market types
- Excludes correlation-blocked markets
- Shows AI-only estimate when no Polymarket data

### Match Page
- Added single inline limited-data note (one-time, no repetition)
- Removed per-match refresh buttons
- Added DataFreshnessIndicator (read-only timestamp)

### Homepage
- Default changed to 72h window (today + 2 days)
- Full 2-week window is backend-only

---

## Files Modified

**Engine:**
- `src/services/engine.ts` - Complete ENGINE_SPEC v1.1 implementation

**UI Components:**
- `src/components/match/analysis-card.tsx`
- `src/components/match/market-sentiment-display.tsx`
- `src/components/match/all-markets-display.tsx`
- `src/components/match/data-freshness-indicator.tsx` (new)

**Pages:**
- `src/app/match/[id]/page.tsx`
- `src/app/page.tsx`

**Utilities:**
- `src/lib/date.ts` - Added `get72HourWindowDates()`

**Removed:**
- `src/components/match/refresh-button.tsx`
- `src/components/match/auto-refresh-wrapper.tsx`

---

## Validation

- Build: PASS
- TypeScript: PASS
- All routes functional

---

## Next Steps

1. Deploy to production via `git push origin main`
2. Test with live fixtures
3. Validate dominant/flat/volatile fixtures behave correctly
